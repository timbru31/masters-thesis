\subsection{Algorithm}

\subsubsection{pros}

\begin{enumerate}
	\item Collisions in MD5 or SHA1 are no problem, already stated/analyzed in the RFC
\end{enumerate}

\subsubsection{cons}

"Just an algorithm"

\begin{enumerate}
	\item synchronization
	\item invalidation
	\item nobody knows how the algorithm is implemented
	\item Differences (e.g. Steam - only 5 digits, limited Alphabet)
	\item Brute Force if server does not limit
	\item Not phishing resistant
\end{enumerate}

As both the \gls{hotp} and the \gls{totp} are based on the \gls{hmac} algorithm by building the \gls{otp} over the \gls{hmac} function of the secret key and the counter with a truncation, the underlying \gls{hmac} algorithm needs to be evaluated.\\
The important part here is the chosen cryptographic hash algorithm. Mostly \gls{sha}-1 is used, since it's the default of the RFC. Given that both \gls{sha}-1 and MD5 are considered insecure one has to ask if they are still considered secure in the \gls{otp} context.\\
Because the collision resistance of the chosen cryptographic hash algorithm is not important for the security of the \gls{otp} generation those algorithms do not expose a threat.\\
The \gls{bsi} lists these algorithms as secure for HMAC\footcite{bsi2019recommendations}

Citations: \footcite{10.1007/978-3-319-63688-7_19}

It is more important that the algorithm is implemented correctly, in the past e.g. Google did not issue \gls{otp} values with a leading zero. Besides that, the minimum length of the \gls{otp} values are six digits, meanwhile the \gls{rfc} supports up to 10.\\
For example Steam, decided to use a different alphabet and character length.

A theoretical vulnerability is to use the time sync offset feature because it enables an attacker to use a token that's much longer valid than it should be. (\textcolor{red}{as discussed in section xx - time sync/drift})

\subsection{Transportation and Generation}

Given that the generation of the \gls{otp} is considered secure the more important region to analyze is the transportation of these \gls{otp}. In this section the transportation mediums \gls{sms}, e-mail, and apps for the \gls{otp} generation are considered.

\subsubsection{SMS}

The biggest advantage of \gls{sms} as a transportation medium is every mobile, ranging from an old Nokia to a new iPhone XS, is capable of receiving \gls{sms}. All major mobile phone operation systems come with an \gls{sms} application pre-installed, so no external apps are required.\\
\gls{sms} are around \textcolor{red}{1999} and highly accepted and easy to use.

\newpage

While there are some key advantages with \gls{sms} transportation it also comes with a lot of downsides. Besides the cost aspect of \gls{sms} traffic, both for the sender and potentially for the receiver due to roaming fees, too, the current state of \gls{sms} traffic is considered insecure.\\
The \gls{sms} traffic relies on the \gls{ss7} network which was developed in the 1970s. It has multiple security flaws that allows an attacker to eavesdrop or modify the in- and out-coming traffic.\footcite{WELCH201717,7997246,puzankov2017stealthy}

\begin{figure}[hbt]
	\centering
	\includesvg[width=\textwidth,pretex=\relscale{1}]{pics/svg/2fa_flow_ss7}
	\caption[\gls{ss7} exploit to phish an \gls{otp} used in \gls{mfa}]{\gls{ss7} exploit to phish an \gls{otp} used in \gls{mfa}\footnotemark}
	\label{fig:2fa_flow_ss7}
\end{figure}
\footnotetext{Source: diagram by author}

\autoref{fig:2fa_flow_ss7} again shows the described \gls{mfa} flow using \gls{totp}. In this scenario the attacker is still able to phish the \gls{totp} designated for the user. The figure shows that the attacker uses an exploit in the \gls{ss7} network. This allows them to intercept all incoming \glspl{sms}.

\newpage

Another negative aspect of \gls{sms} transportation is the routing. Many companies rely on third-party providers in order to send the \gls{sms} to the user. Often these providers like \textcolor{red}{name some} are using countries where \gls{sms} are very cheap, but on the other hand the \gls{ss7} security measures like \gls{sms} home routing and not enforced. This results in a higher \textcolor{red}{security risk} of the \gls{sms} being compromised while reaching the user. Also, the third party providers are given access to the \gls{otp} which enables the risk of a malicious insider because the security measures might be weaker than the original company.

In contrast to the web and e-mail the user is not very aware of phishing attacks in the \gls{sms} context. Studies however show that a new technique called forward phishing is already in use. In this scenario the attacker sends the victim a (spoofed) \gls{sms} from the fakes service provider to reply with the \gls{otp} code for security measures.\footcite{JAKOBSSON20186,SIADATI201714}

\begin{figure}[hbt]
	\centering
	\includesvg[width=\textwidth,pretex=\relscale{1}]{pics/svg/2fa_flow_forward_phishing}
	\caption[\gls{vcfa} to phish an \gls{otp} used in \gls{mfa}]{\gls{vcfa} to phish an \gls{otp} used in \gls{mfa}\footnotemark}
	\label{fig:2fa_flow_forward_phishing}
\end{figure}
\footnotetext{Source: diagram by author}

\autoref{fig:2fa_flow_forward_phishing} shows an example of a \gls{vcfa}. An attack logs in to the user's account with, e.g., hacked or phished credentials. Because the account is protected by \gls{mfa}, the user receives a verification code via \gls{sms} or smartphone. The attacker send now a fake \gls{sms} to the victim, stating that the service has detected unusual activity and that the user should reply with the just received verification code in order to stop this activity and proof they are the account owner. Of course the attack now has access to the \gls{otp}, too, since they tricked the user into forwarding their code.

Especially for Android there exists multiple \gls{sms} trojans which are capable of intercepting the \gls{sms}, too.

Further, it cannot be guaranteed that the user has a working mobile network, that the registered mobile phone number is still active or that the user receives the \gls{sms} on time. These non-influencable, external factors strengthen the fact that \gls{sms} are not a wise choice as the transportation medium.

Additional weaknesses of \gls{sim} are the attack risks of 

\begin{enumerate}[label=(\alph*)]
	\item \gls{sim} cloning
	\item \gls{sim} swapping scam
\end{enumerate}

\begin{figure}[hbt]
	\centering
	\includesvg[width=\textwidth,pretex=\relscale{1}]{pics/svg/2fa_flow_sim_hack}
	\caption[Social engineering used to phish an \gls{otp} in \gls{mfa}]{Social engineering used to phish an \gls{otp} in \gls{mfa}\footnotemark}
	\label{fig:2fa_flow_sim_hack}
\end{figure}
\footnotetext{Source: diagram by author}

\autoref{fig:2fa_flow_sim_hack} shows presented \gls{mfa} flow using \gls{totp} again, but in this case another phishing scenario. An attacker has again access to the user's password, e.g., from a previous, successful phishing attack. In order to obtain or phish, respectively, they target the human weakness in the cell phone provider of the user. They successfully convince them to activate another \gls{sim} card for the victims phone number and receive the \gls{sms} with the \gls{totp}, too, which enables the attacker to successfully complete the \gls{mfa} flow. Yet another variant which is technically more complex, but feasible, is the \gls{sim} card cloning. This allows the attacker to intercept the \gls{totp}, too, by registering the phone number twice.

% TODO \footcite[See][873]{eckert-it-sec-9} (SIM Clone)
% TODO BSI TR-03107-1 4.3.2 smsTAN
\cite{FIPS198} \cite{SP80063B} (Twitter CEO hack) \cite{twitter-hack}

Given all these facts \gls{sms} transportation should be avoided at all costs,\footcite{JAKOBSSON20186} since there are multiple flaws in the \gls{ss7} network itself and the process how the \gls{sms} reaches the user. It's also not resistant against phishing or mobile phone trojans.
% TODO Citations IMEI twice etc no problem

% TODO BILDER f√ºr Malware

\subsubsection{App}
 
 In contrast to the transportation of the \gls{otp} via \gls{sms}, using a standalone app such as Google Authenticator, Authy or even the mobile \gls{otp} app for Java based phones offers some advantages. While the user has to be connected to the cellular network when receiving the \gls{otp} via \gls{sms}, the app solution works in offline or bad network connectivity use cases, too.
 
 Furthermore, the app solution is cheaper because no transaction fee is due for the sender or receiver. It also eliminates the roaming problem. On the other hand, the app needs to be maintained and updated to protect against, e.g., vulnerabilities in third party libraries and to ensure compatibility with future devices and \gls{os} versions.
 
 The setup of the \gls{otp} is not phishing resistant either. A malware on, e.g., the desktop can intercept the shared secret or the mobile phone can contain malware. This malware can intercept for instance the camera, later access the generated \gls{otp}, or access the app's database where the secrets are stored.
 
 Besides that, the app itself can contain vulnerabilities such as Authy suffered from a vulnerable backend that could be exploited to bypass the \gls{2fa}. Additionally, the user has to ask if the app is legtimite and from a trustworthy source and have faith in the app that it keeps their data safe.\footcites[See][]{eset-bypass2fa}[See][]{sakurity-authy}
 
\subsubsection{E-mail}

Another widely used form to transmit the \gls{otp} from the server to the user is the distribution via e-mail. E-mails are by comparison with apps more acceptable and do not require a user to give aways their cellphone number. While it eliminates the need to rely on external services and given the fact that the user already registered an account with the corresponding site, it is assumed the user owns an e-mail account.

However, e-mail traffic comes with threats, too. In the first place, unencrypted e-mail traffic can be intercepted by a \gls{mitm}, therefore exposing the secret. In 2019 \textcolor{red}{?? \%} of all e-mail traffic is still unencrypted. A malware on the desktop or smartphone can intercept incoming e-mail and even delete the message without the users knowledge.

Besides that, e-mails re-introduce the problem of delayed reception of the \gls{otp} since especially techniques such as grey-listing delay incoming messages to avoid spam. Examples such as network connectivity problems, dedicated attack (\gls{ddos}) or exceeded e-mail storage quota further increase the potential of unreliable \gls{otp} transportation